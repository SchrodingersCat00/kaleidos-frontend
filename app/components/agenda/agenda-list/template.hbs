
<div class="vl-u-spacer vl-alert--error">
  {{#if (gt brokenAgendaItems.length 0)}}
  <div class="vl-u-spacer-extended-s vlc-agenda-items-new--spaced">
    <span class="vl-title vl-title--h3">
      {{t "faulty-agendaitems"}}
    </span>
  </div>
    {{#each brokenAgendaItems as |brokenAgendaItem|}}
      <div class="vlc-agenda-items-new__sub-item">
          <p>{{brokenAgendaItem.title}}
          <button class='vl-button vl-button--tertiary' {{action "deleteBrokenAgendaitem" brokenAgendaItem}}>
            {{t "delete"}}
            </button>
          </p>
      </div>
    {{/each}}
  {{/if}}
</div>
{{#if (not selectedAgendaItem)}}
  <div class="vl-u-display-flex vl-u-flex-space-between">
    <span class="vl-title vl-title--h3">
      {{t "agendaitems-subtitle"}}
    </span>
    {{#if (or isAdmin isEditor)}}
      {{#if (await currentAgenda.isDesignAgenda)}}
        <div class="vl-u-display-flex vl-u-flex-end">
          <div class="vl-u-spacer-extended-left-s">
            <a class="vl-link" {{action "toggleChangesOnly"}}>
              {{#if (not isShowingChanges)}}
                {{t "show-changes"}}
              {{else}}
                {{t "show-all"}}
              {{/if}}
            </a>
          </div>
          <div class="vl-u-spacer-extended-left-s">
            <a class="vl-link" {{action "toggleIsEditingOverview"}}>
              {{t "edit"}}
            </a>
          </div>
        </div>
      {{/if}}
    {{/if}}
  </div>
{{else}}
  <div
    class="vl-u-spacer-extended-s vlc-agenda-items-new--spaced vl-u-display-flex vl-u-flex-space-between"
  >
    <span class="vl-title vl-title--h3 no-margin">
      {{t "agendaitems-subtitle"}}
    </span>
    {{#if (await currentAgenda.isDesignAgenda)}}
      <div class="vl-u-display-flex vl-u-flex-end">
        <a class="vl-link" {{action "toggleChangesOnly"}}>
          {{#if (not isShowingChanges)}}
            {{t "show-changes"}}
          {{else}}
            {{t "show-all"}}
          {{/if}}
        </a>
      </div>
    {{/if}}
  </div>
{{/if}}
{{#if (and (eq agendaitemGroups.length 0) (not (await minutesApproval)))}}
  <div class="vl-u-spacer-extended-top-s">
    {{web-components/vl-alert message=(t "no-agendaitems-yet")}}
  </div>
{{/if}}
{{#if selectedAgendaItem}}
  {{#if (await minutesApproval)}}
    <div class="vlc-agenda-items-new__sub-item">
      {{agenda/agenda-list/list-item
        agendaitem=(await minutesApproval)
        selectAgendaItem=(action "selectAgendaItem")
      }}
    </div>
  {{/if}}
  {{#each (await agendaitemGroups) as |group|}}
    <div class="{{spacerClass}}">
      {{#each group.groups as |agendaitemGroup|}}
        {{#if (gt agendaitemGroup.agendaitems.length 0)}}
          {{#if (not isShowingChanges)}}
            <div class="vlc-list-section-header">
              {{#each agendaitemGroup.mandatees as |mandatee|}}
                {{mandatee.title}}<br />
              {{/each}}
            </div>
          {{/if}}
          {{#each agendaitemGroup.agendaitems as |agendaitem|}}
            {{#if (not isShowingChanges)}}
              <div class="vlc-agenda-items-new__sub-item">
                {{agenda/agenda-list/list-item
                  agendaitem=agendaitem
                  selectAgendaItem=(action "selectAgendaItem")
                }}
              </div>
            {{else if (await agendaitem.hasChanges)}}
              <div class="vlc-agenda-items-new__sub-item">
                {{agenda/agenda-list/list-item
                  agendaitem=agendaitem
                  isShowingChanges=isShowingChanges
                  selectAgendaItem=(action "selectAgendaItem")
                }}
              </div>
            {{/if}}
          {{/each}}
        {{/if}}
      {{/each}}
    </div>
  {{/each}}
{{else if (not selectedAgendaItem)}}
  {{#if (await minutesApproval)}}
    <div class="vlc-agenda-items-new__sub-item">
      {{agenda/agenda-list/list-item
        agendaitem=(await minutesApproval)
        isEditingOverview=isEditingOverview
        selectAgendaItem=(action "selectAgendaItem")
      }}
    </div>
  {{/if}}
  {{#each (await agendaitemGroups) as |group|}}
    <div class="{{spacerClass}}">
      <div class="vl-u-spacer-extended-bottom">
        {{#each group.groups as |agendaitemGroup|}}
          {{#if (gt agendaitemGroup.agendaitems.length 0)}}
            {{#if (not isShowingChanges)}}
              <div class="vlc-list-section-header">
                {{#each agendaitemGroup.mandatees as |mandatee|}}
                  {{mandatee.title}}<br />
                {{/each}}
              </div>
            {{/if}}
            {{#sortable-group
              tagName="div"
              onChange=(action
                "reorderItems" agendaitemGroup
              ) as |sortableGroup|
            }}
              {{#each agendaitemGroup.agendaitems as |agendaitem|}}
                {{#if (not isShowingChanges)}}
                  {{#sortable-item
                    tagName="div"
                    model=agendaitem
                    group=sortableGroup
                    distance=30
                    handle=".vlc-agenda-items-new__sub-item"
                  }}
                    <div class="vlc-agenda-items-new__sub-item">
                      {{agenda/agenda-list/list-item
                        agendaitem=agendaitem
                        isEditingOverview=isEditingOverview
                        isShowingChanges=isShowingChanges
                        selectAgendaItem=(action "selectAgendaItem")
                      }}
                    </div>
                  {{/sortable-item}}
                {{else if (await agendaitem.hasChanges)}}
                  {{#sortable-item
                    tagName="div"
                    model=agendaitem
                    group=sortableGroup
                    distance=30
                    handle=".vlc-agenda-items-new__sub-item"
                  }}
                    <div class="vlc-agenda-items-new__sub-item">
                      {{agenda/agenda-list/list-item
                        agendaitem=agendaitem
                        isEditingOverview=isEditingOverview
                        isShowingChanges=isShowingChanges
                        selectAgendaItem=(action "selectAgendaItem")
                      }}
                    </div>
                  {{/sortable-item}}
                {{/if}}
              {{/each}}
            {{/sortable-group}}
          {{/if}}
        {{/each}}
      </div>
    </div>
  {{/each}}
{{/if}}
{{#if (not selectedAgendaItem)}}
  <div class="vl-u-spacer-extended-bottom-s">
    <span class="vl-title vl-title--h3">
      {{t "announcements-subtitle"}}
    </span>
  </div>
{{else}}
  <div class="vl-u-spacer-extended-s vlc-agenda-items-new--spaced">
    <span class="vl-title vl-title--h3">
      {{t "announcements-subtitle"}}
    </span>
  </div>
{{/if}}
<div class="vl-u-spacer">
  {{#if (gt (await announcements.length) 0)}}
    {{#each (await announcements) as |announcement index|}}
      <div class="vlc-agenda-items-new__sub-item">
        {{agenda/agenda-list/list-item
          agendaitem=announcement
          index=index
          isEditingOverview=isEditingOverview
          selectAgendaItem=(action "selectAgendaItem")
        }}
      </div>
    {{/each}}
  {{else}}
    {{web-components/vl-alert message=(t "no-announcements-yet")}}
  {{/if}}
</div>
