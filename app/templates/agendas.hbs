{{title (t "agenda-title")}}
<div class="vl-u-bg-alt">
  <div class="vlc-page-header">
    <div class="vlc-toolbar vlc-toolbar--auto">
      <div class="vlc-toolbar__left">
        <div class="vlc-toolbar__item">
          <h1 class="vlc-page-header__title">
            {{t "agenda-title"}}
          </h1>
        </div>
      </div>
      <div class="vlc-toolbar__right">
        {{#if isEditor}}
          <div class="vlc-toolbar__item">
            <button
              class="vl-button vl-button--narrow vl-button--icon-before"
              {{action "createNewSession"}}
            >
              <i
                class="vl-button__icon vl-button__icon--before vl-vi vl-vi-add"
              ></i>
              {{t "new-agenda"}}
            </button>
          </div>
        {{/if}}
      </div>
    </div>
  </div>
</div>
{{#if (gt model.length 0)}}
  <div class="vlc-scroll-wrapper">
    <div class="vlc-scroll-wrapper__body">
      <div class="vl-u-spacer-extended-l">
        <div class="vl-u-spacer--large">
          {{#if (eq page 0)}}
            {{agenda/future-agendas
              meetings=futureMeetings
              nearestMeeting=(await nearestMeeting)
              type="future"
              title=(t "future-agendas")
              selectAgenda=(action "selectAgenda")
            }}
            {{agenda/future-agendas
              meetings=nearestMeeting
              type="active"
              title=(t "active-agenda")
              selectAgenda=(action "selectAgenda")
            }}
          {{/if}}
          <div class="vl-u-spacer--large">
            <div class="vl-u-display-flex vl-u-flex-space-between">
              <h2 class="vl-title vl-title--h3">
                {{t "history"}}
                {{#if (or from to)}}
                  ( {{moment-format from "DD-MM-YYYY"}} - {{moment-format to "DD-MM-YYYY"}} )
                {{/if}}
              </h2>
              <div class="vl-u-spacer-extended-bottom-s">
                <div class="vlc-input-field-group-wrapper vlc-input-field-group-wrapper--inline">
                  <div class="vlc-input-field-group vlc-input-field-group--gmeeting">
                    {{input
                      type="text"
                      id=id
                      class="vl-input-field"
                      value=dateFilter
                      placeholder="bv. 02/2018"
                    }}
                  </div>
                  <div class="vlc-input-field-group">
                    <button class="vl-button vl-button--secondary vl-button--icon" type="submit"
                      onclick={{action "setDateFilter" dateFilter}}>
                      <i class="vl-vi vl-vi-magnifier"></i>
                    </button>
                  </div>
                </div>
              </div>
            </div>
            <div class="vl-u-spacer-extended-bottom-l">
              {{#data-table
                content=(await model)
                class="vl-data-table vl-data-table--zebra vl-data-table--align-middle"
                page=page
                size=size
                sort=sort
                isLoading=isLoadingModel as |table|
              }}
                {{#table.content as |c|}}
                  {{#c.header}}
                    {{th-sortable
                      class="vl-data-table-col-3 vl-data-table__header-title"
                      currentSorting=sort
                      field="planned-start"
                      label=(t "agenda")
                    }}
                    {{th-sortable
                      class="vl-data-table-col-2 vl-data-table__header-title"
                      field="agendas"
                      label=(t "agenda-version")
                    }}
                    <th class="vl-data-table-col-2 vl-data-table__header-title table-header-unsortable">
                      {{t "latest-modified"}}
                    </th>
                    {{th-sortable
                      class="vl-data-table-col-2 vl-data-table__header-title"
                      currentSorting=sort
                      field="is-final"
                      label=(t "status")
                    }}
                    {{th-sortable
                      class="vl-data-table-col-2 vl-data-table__header-title"
                      currentSorting=sort
                      field="kind"
                      label=(t "kind")
                    }}
                    <th class="vl-data-table-col-1"></th>
                  {{/c.header}}
                  {{#c.body as |meeting|}}
                    {{#if (not meeting.alreadyShown)}}
                      <td {{action "selectAgenda" meeting}}>
                        {{t "agenda-for"}}
                        {{moment-format meeting.plannedStart "DD.MM.YYYY"}}
                      </td>
                      <td {{action "selectAgenda" meeting}}>
                        {{#if (is-pending meeting.latestAgendaName)}}
                          <div
                            class="skeletal-loader"
                            role="alert"
                            aria-busy="true"
                          ></div>
                        {{else}}
                          {{await meeting.latestAgendaName}}
                        {{/if}}
                      </td>
                      <td {{action "selectAgenda" meeting}}>
                        {{#if (is-pending meeting.latestAgenda)}}
                          <div
                            class="skeletal-loader"
                            role="alert"
                            aria-busy="true"
                          ></div>
                        {{else}}
                          {{moment-format
                            (await meeting.latestAgenda.modified)
                            "DD-MM-YYYY HH:mm"
                          }}
                        {{/if}}
                      </td>
                      <td>
                        {{#if meeting.isFinal}}
                          {{t "closed"}}
                        {{else}}
                          {{t "opened"}}
                        {{/if}}
                      </td>
                      <td {{action "selectAgenda" meeting}}>
                        {{meeting.kindToShow.label}}
                      </td>
                      <td class="vl-u-align-center">
                        <button
                          class="vl-button vl-button--link vl-button--icon"
                          {{action "selectAgenda" meeting}}
                        >
                          <i class="vl-button__icon vl-vi vl-vi-nav-right"></i>
                        </button>
                      </td>
                    {{/if}}
                  {{/c.body}}
                {{/table.content}}
              {{/data-table}}
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
{{else}}
  <div class="vl-u-spacer-extended-l">
    {{web-components/vl-alert message=(t "no-meetings")}}
  </div>
{{/if}}
{{#if creatingNewSession}}
  {{#web-components/vl-modal
    isOverlay=true
    title=(t "new-agenda")
    closeModal=(action "cancelNewSessionForm")
  }}
    {{sessions/forms/new-session
      successfullyAdded=(action "successfullyAdded")
      cancelForm=(action "cancelNewSessionForm")
    }}
  {{/web-components/vl-modal}}
{{/if}}
